

# Organizar y procesar los datos

El objetivo de este segundo día de trabajo en la actividad 2 era encontrar errores en los datos que hemos descargado de la AEMET. Para ello necesitamos generar un script que encuentre errores en los datos y los muestre por pantalla. Si no encuentra errores en nuestros ficheros, podemos modificar uno de los archivos .dat y simular un error en los datos para ver si nuestro script funciona.
Cuando detectemos un problema lo guardamos en un archivo de log.

## Errores encontrados 

P1 - Diciembre de 2006 solo contamos con datos de precipitaciones de 1 solo día y del resto no contamos con ningún dato. Por lo tanto faltan valores. 

> **Lectura de ficheros:** Nos tenemos que asegurar de que todos los ficheros tienen el mismo formato y que aparentemente són correctas. Ya que si hay algun error nuestro programa lo localizará para poder resolverlo facilmente.

## Paso 1

Podemos ver que los datos recolectados mediante la tarea 1 se dividen en las siguientes columnas:

| Dato 1 | Dato 2 | Dato 3 | Dato 4 | Dato 5 |
|--------|--------|--------|--------|--------|
| ID del pluviómetro | Año | Mes | Precip día 1 | Precipit día 2 ... |

> **⚠️ Dato -999 ⚠️** --> Sin datos registrados por error de parte de la estación meteorologica.
> **Precipitaciones** --> Las precipitaciones las mide en milímetros = litros por metro cuadrado. Los datos que tenemos por día reflejan cuánta lluvia ha registrado un pluviómetro cada día.

## Paso 2
Verificar que todos los archivos tienen el mismo formato.
Se puede realizar un script de validación básica que lea las primeras filas de cada archivo y determine el número de columnas y delimitadores. Los delimitadores son espacios. 
Hemos pedido que nos haga un script que nos muestre por pantalla el número columnas y de delimitadores que tiene cada documento.

## Paso 3
Limpieza de los datos.
Asegurar que los datos no contengan errores, valores que falten o inconsistencias:
Lectura: Utilizar pandas para gestionar los archivos y gestionar errores de lectura.
Verifica la consistencia de las columnas: Asegurar que los datos en cada columna tienen el tipo esperado (numérico, fecha, etc.).
Gestionar valores que faltan o corruptos: Identifica y trata datos nulos o valores atípicos.

## Paso 4 

Documenta todo el proceso por si tienes que repetirlo alguna vez.
Indica qué decisiones has tomado, qué has hecho con los valores nulos y cómo has solucionado inconsistencias.
 
### Decisiones tomadas 

Hemos tenido en cuenta que las dos primeras filas de cada “precipitación” siempre contienen la misma información pero con la diferencia de que estos datos pueden variar. A partir de la 3 fila la primera columna nos dirá el ID de la estación, la segunda columna nos indica el año del cual hará referencia y la tercera columna nos indica el mes del año, a continuación de estas columnas los datos nos indican las precipitaciones, también hay que tener en cuenta que los datos se encuentran separados por “ “. 
Al tener en cuenta los el cómo están estructurados los datos hemos creado un código en el cual



Para validar los archivos.dat hemos echo un script en Python el cual se encarga de validar los datos dependiendo si estos contienen en el encabezado.

- Encabezado
-  precip
	- P1(el valor identificativo)
- MIROC5
	- 35.307 (latitud)
- RCP60
	- -2.948 (longitud)
- REGRESION 
- 182 (altura sobre el nivel del mar)
- decimas
	-2006 (año de inicio)
	- 2100 (año final)

Después de comprobar el encabezado podemos comprobar que los datos recopilados por los pluviómetros sean correctos de acuerdo al encabezado.

Las columnas sirven para aclarar en el manual cual es el orden en el cual tienen que ir los valores.

- P1(el valor identificativo) (columna 1)
- 2006 (año) (columna 2)
- 1 (mes) (columna 3)
- 1 (cualquier número) (columna 2)
- -999 (cualquier número) (columna 34)

A la hora de comprobar los valores de los cuales tienen que estar relacionados con el encabezado, es decir, el P1, el 2006 y el 2100 hemos conseguido que el script detecte si hay un error en la validación de estos, pero no con el 35.307, -2.948 y 182.

También hemos conseguido que detecte errores fuera del encabezado, por lo tanto, a partir de la línea 3 del archivo.dat, el script detectará si hay alguna letra en algún valor que no sea el valor identificativo, que entre los valores hay dos separaciones o una tabulación para separarlos, si los años no van acordes a los límites declarados en el encabezado, que los meses sean del 1 al 12 y que haya 31 valores recolectados por el pluviómetro, es decir, la columna siguiente de los meses y la última abra 31 valores.

En el terminal nos dirá los siguientes resultados
- Total de archivos procesados: x
- Total de líneas procesadas: x
- Total de valores procesados (excluyendo -999) x
- Total de valores faltantes (-999): x
- Porcentaje de valores faltantes sobre el total de valores: x%

A su vez nos creará dos log, uno recopilara lo mostrado en el terminal, el otro recopilar los errores encontrados en los archivos.dat y nos indicarán en que archivo, línea y columna se encuentra dicho error.

![Imagen](./media/Imagen2.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

![Imagen](./media/Imagen1.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

![Imagen](./media/Imagen.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

![Imagen](./media/Imagen3.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

![Imagen](./media/Imagen4.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

- Hoy hemos conseguido actualizar nuestro código para que valide varios datos correctamente:
- Valida datos de dos cabeceras
- Valida el pluviómetro
- Valida los años/días

![Imagen](./media/Dia4imagen1.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

![Imagen](./media/Dia4imagen2.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

![Imagen](./media/Dia4imagen3.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

Aparte de validar datos, también hemos conseguido calcular los promedios de lluvia y la tendencia a lo largo de los años
Tendencia al cambio: la tasa de variación anual de las precipitaciones

![Imagen](./media/Tendenciacambio.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

La formula para calcularlo

![Imagen](./media/Formula.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

Los años com mas lluvia y los mas secos separados entre los años pasados y los futuros

![Imagen](./media/Extremos.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

![Imagen](./media/Extremos2.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

Análisis de datos:

- Promedio total de precipitaciones por período: calcula el promedio total de precipitación acumulada para dos períodos: años pasados (2006-2024) y proyecciones futuras (2025-2100).
- Años con el Mayor Incremento o Decremento de Precipitación Anual: identifica los años con el mayor aumento o disminución porcentual en la precipitación anual comparada con el año anterior. Expresado en l/m2 al año.

![Imagen](./meida/Analisis.png){: width="100%" align="center" style="display: block; margin-left: auto; margin-right: auto;"}

[**Índice**](../README.md){: .btn .btn-primary .float-right}


