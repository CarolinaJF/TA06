<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Pluviómetros</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <h1>Mapa de Pluviómetros</h1>
    <input type="text" id="searchInput" placeholder="Buscar pluviómetro (ej. P1)">
    <button onclick="searchPluviometer()">Buscar</button>
    <div id="map" style="height: 600px;"></div>

    <script>
        let map;
        let markers = {};

        function initMap() {
            map = L.map('map').setView([19.4326, -99.1332], 6); // Centro inicial del mapa

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            fetch('pluviometros.csv')
                .then(response => response.text())
                .then(data => {
                    const rows = data.split('\n').slice(1); // Ignorar la primera fila (encabezados)
                    rows.forEach(row => {
                        const [nombre, latitud, longitud] = row.split(',');
                        const marker = L.marker([parseFloat(latitud), parseFloat(longitud)]).addTo(map);
                        marker.bindPopup(nombre);
                        markers[nombre] = marker;
                    });
                });
        }

        function searchPluviometer() {
            const searchValue = document.getElementById('searchInput').value.trim();
            if (markers[searchValue]) {
                map.setView(markers[searchValue].getLatLng(), 15); // Centrar y hacer zoom en el marcador
                markers[searchValue].openPopup();
            } else {
                alert('Pluviómetro no encontrado');
            }
        }

        window.onload = initMap;
    </script>
</body>
</html>
